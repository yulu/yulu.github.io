<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Explore Instagram-like Filters with Photoshop and OpenGL ES Shaders</title>
    <meta name="description" content="I am migrating from a blog service provider to github, still trying out with Jekyll
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://yulu.github.io/blog1/2013/02/20/instagram-filter.html">
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link href="/css/nav.css" type="text/css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

    <!-- Go to www.addthis.com/dashboard to customize your tools -->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-551ec72a4d0e58c1" async="async"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PB2VMZMH');</script>
    <!-- End Google Tag Manager -->
    <!--latex-->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <meta name="google-site-verification" content="x60nHOyc_rEQN3p4MCF7G6h-7Yvng4iMYB06RrSZNS4" />
</head>

    
    <body>

    <header>
    <div class="site-header">
        <a href="/"><span>Little<b>CheeseCake.</b></span></a>
    </div>
    <!--nav button-->
<div class="button-background">
    <div class="button-toggle" id="toggle">

        <span class="top"></span>
        <span class="middle_1"></span>
        <span class="middle_2"></span>
        <span class="bottom"></span>
    </div>
</div>
<!--menu overlay-->
<div class="overlay" id="overlay">
    <nav>
        <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/blog2/index.html">Journal</a></li>
            <li><a href="/blog1/index.html">Tech Blog</a></li>
            <li><a href="/books/index.html">Books</li>
            <li><a href="https://www.youtube.com/user/YuLu8798" target="_blank">Vlog</a></li>
            <li><a href="/about/about.html">About</a></li>
        </ul>
    </nav>
</div>
<!--jquery script-->
<script>
    $('.button-background').click(function() {
        $('#toggle').toggleClass('active');
        $('#overlay').toggleClass('open');
    });
</script>

</header>


    <div class="post-image-container">
        
        <img class="post-image" src="https://s3.ap-southeast-1.amazonaws.com/littlecheesecake.me/blog-post/tide.jpg"/>
              
        
        
        
          
    </div>

    <div class="post-wrapper">
        <!-- header -->

        <div class="wrapper">
            <header class="post-header">
                <h1 class="post-title">Explore Instagram-like Filters with Photoshop and OpenGL ES Shaders</h1>
                <p class="post-meta">Feb 20, 2013</p>
            </header>
        </div>

        <!-- table of content -->
        <div class="post-toc" id="toc">  </div> 

        <article class="post-content">
            <p>I used to spend quite some time working with Photoshop®, to edit photos or do some digital painting. However I became too lazy to PS since I started to use smartphones. Apps like Instagram® seems to be able to do the processing job more efficiently and produce results that look surprisingly amazing (not considering the quality loss of the photo). After studying the OpenGL Shaders, I thought I should be enable to do mimic the filter effect using shaders, with those previous experience working with Photoshop®. I could first explore in Photoshop® to figure out the steps to take to produce the filter effect. Then I could implement it using OpenGL ES Shaders. After spending some time in research, I kind of found the way to duplicate the filter effect, might not be exactly the same, but the feeling is captured. Take the Hudson filter as an example, I summarized the work I have done.</p>

<p><img src="https://s3.ap-southeast-1.amazonaws.com/littlecheesecake.me/blog-post/blog1/archive/17067546716_44fe02ee61.jpg" alt="ins-1" /></p>

<h3 id="working-with-photoshop">Working with Photoshop®</h3>

<p>Learned from a digital photography course in the college, the first thing we need to do when loading an photo into the Photoshop, is to adjust the level and curve. However I think level and curve adjusting is not that easy to implement in the shaders. How about a less effective but simpler way: adjust Brightness/Contrast/Saturation. All these three steps can be easily realized by blending the image with a base image (either a constant image or the luminanced image of itself). By simply doing these, the quality of the image can be improved quite a lot.</p>

<p><img src="https://s3.ap-southeast-1.amazonaws.com/littlecheesecake.me/blog-post/blog1/archive/17067547336_95c1901627.jpg" alt="ins-2" /></p>

<p><img src="https://s3.ap-southeast-1.amazonaws.com/littlecheesecake.me/blog-post/blog1/archive/16886111067_a545bbf835.jpg" alt="ins-3" /></p>

<p>Then if the filter favors a particular color, can adjust the color balance a bit. Or can also add a filter layer on top then blend it with the base image. Hudson is a filter to make the image have an icy look, the slight tint and altered lighting give the images a colder feel. Therefore a radial gradient mask with blue to black is used for blending. With a lot trials, I found that overlay blending mode is best suitable to produce the vignetting effect (darkens the corners). Overlay blending is a combination of multiply and screen. It darkens the darker part and brightens the lighter part of the base image. And we can adjust the opacity of the top filtering layer to make the effect less strong.</p>

<p><img src="https://s3.ap-southeast-1.amazonaws.com/littlecheesecake.me/blog-post/blog1/archive/16905949040_cb6e62df4b.jpg" alt="ins-4" /></p>

<p><img src="https://s3.ap-southeast-1.amazonaws.com/littlecheesecake.me/blog-post/blog1/archive/17067549246_c611ab20de_z.jpg" alt="ins-5" /></p>

<p>Basically that’s it! Just simply three steps: 1) adjust B/C/S, 2) adjust color balance, 3) overlay blend a radial gradient layer with some opacity. Let’s see the result. Emm.. not exactly, but similar.</p>

<p><img src="https://s3.ap-southeast-1.amazonaws.com/littlecheesecake.me/blog-post/blog1/archive/16907301009_156210a24a.jpg" alt="ins-6" /></p>

<h3 id="implement-using-opengl-es-shaders">Implement using OpenGL ES Shaders</h3>

<p>So, I have three things to do: adjust the B/C/S, change the color balance and add a new layer of texture to overlay blend on top.</p>

<h4 id="adjust-the-bcs">Adjust the B/C/S</h4>

<p>In my previous post, I have discussed all the three processes, I just combine them into a single function in the Fragment Shader.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">vec3</span> <span class="nf">BrightnessContrastSaturation</span><span class="p">(</span><span class="n">vec3</span> <span class="n">color</span><span class="p">,</span> <span class="kt">float</span> <span class="n">brt</span><span class="p">,</span> <span class="kt">float</span> <span class="n">con</span><span class="p">,</span> <span class="kt">float</span> <span class="n">sat</span><span class="p">){</span>
    <span class="n">vec3</span> <span class="n">black</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.,</span> <span class="mi">0</span><span class="p">.,</span> <span class="mi">0</span><span class="p">.);</span>
    <span class="n">vec3</span> <span class="n">middle</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">luminance</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">W</span><span class="p">);</span>
    <span class="n">vec3</span> <span class="n">gray</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="n">luminance</span><span class="p">,</span> <span class="n">luminance</span><span class="p">,</span> <span class="n">luminance</span><span class="p">);</span>
    <span class="n">vec3</span> <span class="n">brtColor</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">black</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">brt</span><span class="p">);</span>
    <span class="n">vec3</span> <span class="n">conColor</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">middle</span><span class="p">,</span> <span class="n">brtColor</span><span class="p">,</span> <span class="n">con</span><span class="p">);</span>
    <span class="n">vec3</span> <span class="n">satColor</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">conColor</span><span class="p">,</span> <span class="n">sat</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">satColor</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<h4 id="adjust-color">Adjust color</h4>

<p>I slightly adjust the single channel.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="c1">//add blue</span>
<span class="n">vec3</span> <span class="n">blue_result</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="n">bcs_result</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">bcs_result</span><span class="p">.</span><span class="n">g</span><span class="p">,</span> <span class="n">bcs_result</span><span class="p">.</span><span class="n">b</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span></code></pre></figure>

<h4 id="overlay-blending">Overlay blending</h4>

<p>The function of overlay blending:</p>

\[f(a,b)=\left\{ 
\begin{array}{l l} 
2ab &amp; \quad \text{if $b &lt; 0.5$}\\
1-2(1-a)(1-b) &amp; \quad \text{otherwise} 
\end{array} \right.\]

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">vec3</span> <span class="nf">ovelayBlender</span><span class="p">(</span><span class="n">vec3</span> <span class="n">Color</span><span class="p">,</span> <span class="n">vec3</span> <span class="n">filter</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">vec3</span> <span class="n">filter_result</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">luminance</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">filter</span><span class="p">,</span> <span class="n">W</span><span class="p">);</span> 
    <span class="k">if</span><span class="p">(</span><span class="n">luminance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">filter_result</span> <span class="o">=</span> <span class="mi">2</span><span class="p">.</span> <span class="o">*</span> <span class="n">filter</span> <span class="o">*</span> <span class="n">Color</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">filter_result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="p">.</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="p">.</span> <span class="o">*</span><span class="p">(</span><span class="n">filter</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span> <span class="o">-</span> <span class="n">Color</span><span class="p">);</span> 
    <span class="k">return</span> <span class="n">filter_result</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>The result from shader implementation:</p>

<p><img src="https://s3.ap-southeast-1.amazonaws.com/littlecheesecake.me/blog-post/blog1/archive/16471061984_33530f710f.jpg" alt="ins-7" /></p>

<h4 id="some-other-exploration">Some Other Exploration</h4>

<p>Similarly I create more filters to mimic the Instagram® style.</p>

<ul>
  <li>
    <p>I add noise at the edge of the top filter lay, to produce the over- exposured film effect in Hefe filter</p>
  </li>
  <li>
    <p>Give high saturation to vibrate the color and to emphasize the dark corners to get X-pro</p>
  </li>
  <li>
    <p>Reduce the saturation and add a lot of red and yellow, to give the feel of Rise filter</p>
  </li>
  <li>
    <p>Add a red to purple filter to get the Toaster effect</p>
  </li>
</ul>

<h3 id="closure">Closure</h3>

<p>This is so fun! Weeks ago I was told by my friend of the words</p>

<blockquote>
  <p>CONNECTING THE DOTS</p>
</blockquote>

<p>I start to realize what it means. Find the things you are good at and try to make connection and produce better work on it. I will definitely continue with this work. I am also glad to share with anyone who are interested in this area, find the full implementation of the basic image processing using OpenGL ES Shaders in Android from my github. Source Code on <a href="https://github.com/yulu/Instagram_Filter">Github</a></p>



            <div class="post-end">
                <!-- buy me a coffee -->
                <div>
                    <a href="https://www.buymeacoffee.com/8QcoMFJNHD" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 40px !important;width: 150px !important;" ></a>
                </div>
                <div class="share-container">
                    <!-- Go to www.addthis.com/dashboard to customize your tools -->
                    <span class="share-text">Share the post </span><div class="addthis_sharing_toolbox"></div>
                </div>
                <div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//littlecheesecakeme.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </article>
    </div>

    <footer>
     <div class="site-footer page">
         <p>Build with love, <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://github.com/yulu/yulu.github.io">Github Page</a> by <a href="/about/about.html"><em>Yu Lu</em></a></p>
    </div>
    
</footer>
    
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PB2VMZMH"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    </body>

    <!--jquery script for sticky toc-->
    <script>
        window.onscroll = function() {myFunction()};

        // Get the header
        var header = document.getElementById("toc");

        // Get the offset position of the navbar
        var sticky = header.offsetTop;

        // Add the sticky class to the header when you reach its scroll position. Remove "sticky" when you leave the scroll position
        function myFunction() {
            if (window.pageYOffset > sticky) {
                header.classList.add("sticky");
            } else {
                header.classList.remove("sticky");
            }
        }
    </script>
</html>
